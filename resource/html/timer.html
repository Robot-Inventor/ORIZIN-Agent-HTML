<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="Expires" content="86400">
        <link rel="apple-touch-icon" sizes="180x180" href="../image/favicon/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="../image/favicon/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="../image/favicon/favicon-16x16.png">
        <link rel="manifest" href="../image/favicon/site.webmanifest">
        <link rel="mask-icon" href="../image/favicon/safari-pinned-tab.svg" color="#ff6a00">
        <link rel="shortcut icon" href="../image/favicon/favicon.ico">
        <meta name="apple-mobile-web-app-title" content="ORIZIN Agent">
        <meta name="application-name" content="ORIZIN Agent">
        <meta name="msapplication-TileColor" content="#da532c">
        <meta name="msapplication-config" content="../image/favicon/browserconfig.xml">
        <meta name="theme-color" content="#2a1100">
        <title>ORIZIN Timer</title>
        <meta name="description" content="オープンソースのAIアシスタント「ORIZIN_Agent」です。">
    </head>
    <body>
        <style>
            @font-face {
                font-family: "League Spartan";
                src: url("../font/LeagueSpartan-Regular.ttf") format("truetype");
                font-display: swap;
            }

            * {
                margin: 0;
                padding: 0;
                font-family: "League Spartan", "Yu Gothic UI", sans-selif;
                color: white;
                transition: 0.3s;
            }

            main {
                width: 100vw;
                height: 100vh;
                background: #111111;
            }

            #circle {
                width: 50vmin;
                height: 50vmin;
                background: #222222;
                border-radius: 100%;
                position: absolute;
                top: 50vh;
                left: 50vw;
                transform: translate(-50%, -50%);
                text-align: center;
            }

            #time {
                width: 50vmin;
                height: auto;
                position: absolute;
                top: 50vh;
                left: 50vw;
                transform: translate(-50%, -50%);
                text-align: center;
            }

            #time div {
                padding: 0.5em;
            }

            .blink {
                animation: blink 0.7s linear infinite alternate;
            }

            @keyframes blink {
                0% {
                    opacity: 1;
                }

                100% {
                    opacity: 0;
                }
            }

            #start {
                background: #4444aa;
                border: none;
                padding: 1em;
                border-radius: 0.5em;
                position: absolute;
                top: calc(50vmin + 40vh);
                left: calc((100vw - 45vmax) / 4);
                transform: translateY(-50%);
                outline: none;
                width: 15vmax;
            }

            #reset {
                background: #4444aa;
                border: none;
                padding: 1em;
                border-radius: 0.5em;
                position: absolute;
                top: calc(50vmin + 40vh);
                left: calc((100vw - 45vmax) / 2 + 15vmax);
                transform: translateY(-50%);
                outline: none;
                width: 15vmax;
            }

            #set_time {
                background: #4444aa;
                border: none;
                padding: 1em;
                border-radius: 0.5em;
                position: absolute;
                top: calc(50vmin + 40vh);
                left: calc(((100vw - 45vmax) / 4) * 3 + 30vmax);
                transform: translateY(-50%);
                outline: none;
                width: 15vmax;
            }

            .time_setting {
                font-size: 10vmin;
                position: absolute;
                top: 50vh;
                left: 0;
                transform: translateY(-50%);
                text-align: center;
            }

            .time_setting input {
                width: 20vw;
                padding: 0;
                background: transparent;
                border: none;
                border-bottom: solid 0.1rem white;
                outline: none;
                text-align: center;
                height: 10vh;
                color: white;
                font-size: inherit;
                transition: 0.3s;
            }

            #hour {
                position: absolute;
                top: 0;
                left: 20vw;
                transform: translate(-50%);
            }

            #minute {
                position: absolute;
                top: 0;
                left: 50vw;
                transform: translate(-50%);
            }

            #second {
                position: absolute;
                top: 0;
                left: 80vw;
                transform: translate(-50%);
            }

            .time_setting input:focus {
                border-bottom: solid 0.1rem #4444aa;
                color: #4444aa;
            }

            #h {
                position: absolute;
                top: 0;
                left: 30vw;
            }

            #m {
                position: absolute;
                top: 0;
                left: 60vw;
            }

            #s {
                position: absolute;
                top: 0;
                left: 90vw;
            }

            #submit {
                background: #4444aa;
                border: none;
                padding: 0.5rem;
                border-radius: 0.5rem;
                outline: none;
                width: 15vmax;
                font-size: 1rem;
                margin: 0;
                height: 2.5rem;
                position: absolute;
                top: 15vh;
                left: 50vw;
                transform: translate(-50%);
            }

            .outer {
                width: 100vw;
                height: 100vh;
                margin: 0;
                padding: 0;
                position: absolute;
                top: 0;
                left: 0;
                background: #111111;
                transition: 0.3s;
            }
        </style>
        <main>
            <div class="outer">
                <div id="circle" onclick="display_started_timer()"></div>
                <div id="time" onclick="display_started_timer()">
                    <div>
                        00:00:00
                    </div>
                </div>
                <button id="start" onclick="display_started_timer()">スタート</button><button id="reset" onclick="reset()">リセット</button><button id="set_time" onclick="document.getElementById('time_setting_outer').style.top = '0'; reset();">再設定</button>
            </div>
            <div class="outer" id="time_setting_outer" onsubmit="submit_time(); return false;">
                <form class="time_setting" id="time_setting_form">
                    <span id="h">h</span><span id="m">m</span><span id="s">s</span>
                    <input type="number" value="00" min="0" step="1" id="hour" required>
                    <input type="number" value="00" min="0" step="1" id="minute" required>
                    <input type="number" value="00" min="0" step="1" id="second" required>
                    <input type="submit" id="submit" value="設定">
                </form>
            </div>
        </main>
        <script src="../javascript/jquery-3.5.1.min.js"></script>
        <script src="../javascript/ripple.min.js"></script>
        <script src="../javascript/fitty.min.js"></script>
        <script src="/eel.js"></script>
        <script>
            fitty("#time div");

            eel.expose(update_time);
            eel.expose(play_time_up_sound);
            eel.expose(timer_status);
            eel.expose(set_time);
            eel.expose(reset_status);

            hour = 0;
            minute = 0;
            second = 10;
            is_reseted = false;

            function update_time(time) {
                document.getElementById("time div").innerHTML = time;
                if(time.match("0+:0+:0+")) {
                    document.getElementById("time div").classList.add("blink");
                    is_finished = true;
                }
            }

            function timer_status() {
                if(is_stopped) {
                    return "stopped"
                } else {
                    return "started"
                }
            }

            function reset_status() {
                result = is_reseted;
                is_reseted = false;
                return result
            }

            function set_time() {
                update_time(hour + ":" + minute + ":" + second);
            }

            $(function() {
                var settings = new Object;
                var pair = location.search.substring(1).split("&");
                for (var i = 0; pair[i]; i++) {
                    var kv = pair[i].split("=");
                    settings[kv[0]] = kv[1];
                }
                hour = settings.h;
                minute = settings.m;
                second = settings.s;
                if(hour + minute + second != 0) {
                    update_time(hour + ":" + minute + ":" + second);
                    document.getElementById("time_setting_outer").style.top = "-100vh";
                    document.getElementById("hour").value = hour;
                    document.getElementById("minute").value = minute;
                    document.getElementById("second").value = second;
                }
            });

            is_stopped = false;
            is_first_start = true;
            is_finished = false;

            function reset() {
                if(is_first_start == false) {
                    is_reseted = true;
                }
                if(is_finished) {
                    is_reseted = false;
                    is_finished = false;
                }
                display_stopped_timer();
                document.getElementById("time div").classList.remove("blink");
                set_time();
                is_first_start = true;
            }

            function display_stopped_timer() {
                document.getElementById("time div").classList.add("blink");
                document.getElementById("start").innerHTML = "スタート";
                document.getElementById("circle").onclick = function() {
                    display_started_timer();
                }
                document.getElementById("start").onclick = function() {
                    display_started_timer();
                }
                document.getElementById("time").onclick = function() {
                    display_started_timer();
                }
                is_stopped = true;
            }

            function display_started_timer() {
                document.getElementById("time div").classList.remove("blink");
                document.getElementById("start").innerHTML = "ストップ";
                document.getElementById("circle").onclick = function() {
                    display_stopped_timer();
                }
                document.getElementById("start").onclick = function() {
                    display_stopped_timer();
                }
                document.getElementById("time").onclick = function() {
                    display_stopped_timer();
                }
                if(is_first_start) {
                    sound = new Audio("");
                    sound.play();
                    eel.timer(hour, minute, second);
                }
                is_stopped = false;
                is_first_start = false;
            }

            function play_time_up_sound() {
                sound = new Audio("../sound/timer.mp3");
                sound.play();
                sound.addEventListener("ended", function() {
                    if(is_stopped == false) {
                        sound.currentTime = 0;
                        sound.play();
                    } else {
                        document.getElementById("time div").classList.remove("blink");
                        reset();
                    }
                }, false);
            }

            function submit_time() {
                document.getElementById("time_setting_outer").style.top = "-100vh";
                hour_setting = document.getElementById("hour").value;
                minute_setting = document.getElementById("minute").value;
                second_setting = document.getElementById("second").value;
                update_time(hour_setting + ":" + minute_setting + ":" + second_setting);
                hour = hour_setting;
                minute = minute_setting;
                second = second_setting;
                is_reseted = false;
            }
        </script>
    </body>
</html>
