<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="Expires" content="86400">
        <link rel="stylesheet" type="text/css" href="../css/layout.css">
        <link rel="icon" href="../image/favicon.ico">
        <title>ORIZIN Agent</title>
        <meta name="description" content="オープンソースのAIアシスタント「ORIZIN_Agent」です。">
    </head>
    <body>
        <header>
        </header>
        <main>
            <div class="main_control_panel">
                <div id="waiting">
                  	<img src="../image/logo.svg" class="logo waiting_mark" id="start_recognition"><br>
                    マークをクリックするかスペースキーを押して話しかけてみてください。
                </div>
                <div id="listening">
                    <img src="../image/listening.svg" class="logo listening_mark"><br>
                    マークをクリックするかスペースキーを押して話しかけてみてください。<br>
                    音声認識中...
                </div>
            </div>
            <div class="bottom_control_panel">
                <textarea id="requestForm">ここにテキストを入力してください。現段階ではここに入力されたテキストを読み上げることしかできませんが，将来的にはここに入力されたテキストに対する応答を読み上げられるようになる予定です。</textarea>
                <button type="button" id="startButton">実行</button>
            </div>
            <div class="bottom_control_panel" id="result_area">
            </div>
        </main>
        <script src="../javascript/jquery-3.4.1.min.js"></script>
        <script src="../javascript/basic.js"></script>
        <script src="/eel.js"></script>
        <script>
            eel.expose(alert);
            function start_speak(content) {
                const script = new SpeechSynthesisUtterance(content);
                speechSynthesis.speak(script);
            }
            async function response(content) {
                let script = await eel.make_response(content)();
                jQuery("#result_area").append(">>" + content + "<br>" + script + "<br>");
                jQuery("#result_area").animate({
                    scrollTop: jQuery(document).height()
                },300);
                start_speak(script);
            }
            const requestForm = document.querySelector('#requestForm');
      　    const startButton = document.querySelector('#startButton');
            startButton.addEventListener('click', function() {
                response(requestForm.value);
            });
            SpeechRecognition = webkitSpeechRecognition || SpeechRecognition;
            const recognition = new SpeechRecognition();
            recognition.onresult = (event) => {
                jQuery("#listening").fadeOut(300);
                jQuery("#waiting").fadeIn(300);
                response(event.results[0][0].transcript);
            }
            jQuery("#start_recognition").click(function() {
                jQuery("#listening").fadeIn(300);
                jQuery("#waiting").fadeOut(300);
                recognition.start();
            });
            jQuery(document).keydown(function(e) {
                switch (e.keyCode) {
                    case 32:
                    jQuery("#start_recognition").click();
                    break;
                }
            });
        </script>
        <style>
            #requestForm {
                width: 100%;
                height: 80%;
                border: 0;
                background: rgba(0, 0, 0, 0);
                color: var(--text);
                margin: 0;
                padding: 0;
                resize: none;
            }
            #startButton {
                 width: 30%;
                 height: 20%;
                 margin: 0;
                 padding: 0;
                 background: var(--theme_color);
                 border: 0;
                 color: white;
            }
            #start_recognition {
                transition: 0.3s;
            }
            #start_recognition:active {
                transform: scale(0.9);
            }
            #result_area {
                text-align: left;
                overflow: scroll;
            }
            #result_area::-webkit-scrollbar {
                display: none;
            }
        </style>
        <!--
        あぁ～あ。今日は2019/12/24，クリスマスイブ。まじで世の中リア充だらけ...。
        いつからクリスマスはカップルでいちゃつくイベントになったんだ？そもそもクリスマスはそんなイベントではない。
        カップルで勝手に楽しむなら楽しんでくれ。でも，それを我々に見せびらかして自慢するのだけはやめてくれ。

        来年こそは彼女作ってやる！！ ヽ(`Д´)ﾉﾌﾟﾝﾌﾟﾝ
        -->
    </body>
</html>
