<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="Expires" content="86400">
        <link rel="stylesheet" type="text/css" href="../css/layout.min.css">
        <link rel="shortcut icon" href="../image/favicon.ico">
        <meta name="theme-color" content="#FF6A00">
        <title>ORIZIN Agent HTML</title>
        <meta name="description" content="オープンソースのAIアシスタント「ORIZIN Agent HTML」です。">
    </head>
    <body>
        <header>
        </header>
        <main>
            <div class="overlay_outer">
                <div class="overlay_inner" id="licence_card">
                    <h2><i class="material_icon">assignment</i>ライセンス</h2>
                    <p>
                        ORIZIN Agent HTMLは、MITライセンスの下に配布されています。使用するにはライセンスに同意する必要があります。（下のボックスはスクロールできます）
<pre>
MIT License

Copyright (c) 2019 - 2021 Robot-Inventor

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
</pre>
                    </p>
                    <menu>
                        <mwc-button onclick="window.close()" icon="close" label="同意しない"></mwc-button><mwc-button onclick="forward_card()" icon="check" label="同意する"></mwc-button>
                    </menu>
                </div>
                <div class="overlay_inner" id="privacy_policy_card">
                    <h2><i class="material_icon">privacy_tip</i>プライバシーポリシー</h2>
                    <p>
                        以下は、ORIZIN Agent HTMLのプライバシーポリシーです。使用するにはプライバシーポリシーに同意する必要があります。（下のボックスはスクロールできます）
<pre>
1. 情報の外部送信について
本ソフトウェアはユーザーの情報の一部を外部に送信することがあります。送信する情報の内容と送信先、目的は次のとおりです。

・ユーザーとの会話の一部をユーザーが設定した検索エンジンに、検索する目的で送信します。

上記に加え本ソフトウェアは音声認識のためにWebブラウザーのWeb Speech APIを使用しており、Webブラウザーは音声認識のため外部に音声を送信する可能性があります。

また、本ソフトウェアは一部の情報をローカルに保存します。本ソフトウェアが保存するファイルのうち、個人情報が含まれる可能性のあるファイルのパスと内容、目的は次のとおりです。

・resource/dictionary/unknownQuestions.txtに会話の一部をログとして保存します。
・memo.txtに会話の一部をメモ機能のために保存します。
・resource/setting/setting.otfdとresource/setting/flag.otfdに設定内容を設定を保持するために保存します。

2. フィードバック機能について
フィードバック機能を使用するとユーザーがフォームに入力した内容がGoogleフォームに送信されます。

3. プライバシーポリシーの変更
プライバシーポリシーは変更される場合があります。変更後のプライバシーポリシーは変更後の本ソフトウェアのバージョンから適用されます。
</pre>
                        <menu>
                            <mwc-button onclick="window.close()" icon="close" label="同意しない"></mwc-button><mwc-button onclick="forward_card()" icon="check" label="同意する"></mwc-button>
                        </menu>
                    </p>
                </div>
                <div class="overlay_inner" id="ask_continue_card">
                    <h2><i class="material_icon">build</i>初期設定を行いますか？</h2>
                    <p>
                        ORIZIN Agent HTMLの初期設定をします。設定はスキップでき、あとから変更できます。設定を続行しますか？
                    </p>
                    <menu>
                        <mwc-button onclick="save_setting()" icon="cancel" label="スキップ"></mwc-button><mwc-button onclick="forward_card()" icon="check" label="続行"></mwc-button>
                    </menu>
                </div>
                <div class="overlay_inner" id="theme_setting_card">
                    <h2><i class="material_icon">palette</i>テーマを選択</h2>
                    <p>
                        テーマ（ORIZIN Agent HTMLの画面の配色）を選択してください。後から設定でカスタマイズできます。
                    </p>
                    <select id="theme">
                        <!-- ここの中身はJavaScriptで動的に生成 -->
                    </select>
                    <br>
                    <menu>
                        <mwc-button onclick="back_card()" icon="arrow_back" label="戻る"></mwc-button><mwc-button onclick="forward_card()" icon="arrow_forward" label="次へ" trailingicon></mwc-button>
                    </menu>
                </div>
                <div class="overlay_inner" id="user_name_setting_card">
                    <h2><i class="material_icon">person</i>ユーザー名を設定</h2>
                    <p>
                        ユーザー名（あなたの呼び名）を入力してください。デフォルトは「ゲスト」です。
                    </p>
                    <underlined-textbox placeholder="ユーザー名を入力" id="user_name" value="ゲスト"></underlined-textbox>
                    <menu>
                        <mwc-button onclick="back_card()" icon="arrow_back" label="戻る"></mwc-button><mwc-button onclick="forward_card()" icon="arrow_forward" label="次へ" trailingicon></mwc-button>
                    </menu>
                </div>
                <div class="overlay_inner" id="search_engine_setting_card">
                    <h2><i class="material_icon">search</i>検索エンジンを選択</h2>
                    <p>
                        ORIZIN Agentがあなたの要求に応じて検索をする際の検索エンジンを選択してください。
                    </p>
                    <select id="search_engine">
                        <option value="Google">Google(デフォルト)</option>
                        <option value="Bing">Bing</option>
                        <option value="YahooJapan">Yahoo! Japan</option>
                        <option value="Yahoo">Yahoo!</option>
                        <option value="DuckDuckGo">DuckDuckGo</option>
                    </select>
                    <br>
                    <menu>
                        <mwc-button onclick="back_card()" icon="arrow_back" label="戻る"></mwc-button><mwc-button onclick="forward_card()" icon="arrow_forward" label="次へ" trailingicon></mwc-button>
                    </menu>
                </div>
                <div class="overlay_inner" id="news_site_url_setting_card">
                    <h2><i class="material_icon">link</i>ニュースサイトのURLを設定</h2>
                    <p>
                        ORIZIN Agentがあなたの要求に応じてニュースを開く際のサイトのURLを入力してください。デフォルトはGoogleニュースです。
                    </p>
                    <underlined-textbox placeholder="URLを入力" id="news_site_url" value="https://news.google.com/?hl=ja&gl=JP&ceid=JP:ja"></underlined-textbox>
                    <menu>
                        <mwc-button onclick="back_card()" icon="arrow_back" label="戻る"></mwc-button><mwc-button onclick="forward_card()" icon="arrow_forward" label="次へ" trailingicon></mwc-button>
                    </menu>
                </div>
                <div class="overlay_inner" id="python_interpreter_setting_card">
                    <h2><i class="material_icon">api</i>インタープリターを設定</h2>
                    <p>
                        Python3のインタープリターを設定します。Python3の実行ファイルへの絶対パスかエイリアスを入力してください。
                    </p>
                    <underlined-textbox placeholder="絶対パスかエイリアスを入力" id="python_interpreter" value="python"></underlined-textbox>
                    <menu>
                        <mwc-button onclick="back_card()" icon="arrow_back" label="戻る"></mwc-button><mwc-button onclick="forward_card()" icon="arrow_forward" label="次へ" trailingicon></mwc-button>
                    </menu>
                </div>
                <div class="overlay_inner" id="setting_finished_message_card">
                    <h2><i class="material_icon">check</i>完了</h2>
                    <p>
                        設定が完了しました！
                    </p>
                    <menu>
                        <mwc-button onclick="back_card()" icon="arrow_back" label="戻る"></mwc-button><mwc-button onclick="save_setting()" icon="check" label="初期設定を終了" trailingicon></mwc-button>
                    </menu>
                </div>
                <progress value="0" max="1">0%</progress>
                <style>
                    .overlay_outer {
                        width: 100vw;
                        height: 100vh;
                        position: fixed;
                        background: rgb(100, 100, 100, 0.5);
                        z-index: 2;
                    }

                    .overlay_inner {
                        border-radius: 0.5rem;
                        box-shadow: 0.1rem 0.1rem 1rem var(--shadow);
                        padding: 2vh;
                        background: var(--card_bg);
                        width: 50vw;
                        height: auto;
                        max-height: 80vh;
                        position: absolute;
                        top: 50vh;
                        left: 50vw;
                        transform: translateY(-50%) translateX(-50%);
                        box-sizing: border-box;
                        z-index: 3;
                        transition: 0.3s;
                    }

                    .overlay_inner menu {
                        float: right;
                    }

                    .overlay_inner button {
                        background: none;
                        color: var(--theme_color);
                        border: none;
                        font-size: 100%;
                        margin: 0 1rem;
                    }

                    #ask_continue_card a {
                        padding: 0;
                        margin: 0 1rem;
                    }

                    .overlay_inner {
                        margin-left: 100vw;
                    }

                    #licence_card {
                        margin-left: 0;
                    }

                    .overlay_inner pre {
                        height: 10rem;
                        border: solid 0.1rem var(--text);
                        padding: 0.5rem;
                        overflow-x: hidden;
                    }

                    .overlay_outer {
                        overflow: hidden;
                    }

                    progress {
                        width: 50vw;
                        position: absolute;
                        top: 80vh;
                        left: 25vw;
                    }
                </style>
            </div>
        </main>
        <script src="../javascript/orizin_ui.min.js"></script>
        <script src="../javascript/basic.js"></script>
        <script src="../javascript/bundle.js"></script>
        <script src="../javascript/mousetrap.min.js"></script>
        <script src="../javascript//mousetrap-bind-dictionary.min.js"></script>
        <script src="/eel.js"></script>
        <script>
            const ALL_CARDS = document.querySelectorAll("div.overlay_inner").length;
            let setup_status = 1;

            const progress = document.querySelector("progress");
            progress.value = setup_status / ALL_CARDS;

            const card_array = document.querySelectorAll("div.overlay_inner");
            let current_card_index = 0;

            function forward_card(current_card_id, next_card_id) {
                card_array[current_card_index].style.marginLeft = "-100vw";
                current_card_index ++;
                card_array[current_card_index].style.marginLeft = "0";
                setup_status += 1;
                progress.value = setup_status / ALL_CARDS;
            }

            function back_card(current_card_id, back_card_id) {
                card_array[current_card_index].style.marginLeft = "100vw";
                current_card_index --;
                card_array[current_card_index].style.marginLeft = "0";
                setup_status -= 1;
                progress.value = setup_status / ALL_CARDS;
            }

            async function generate_theme_menu() {
                const theme_dict = await eel.return_theme_dict()();
                const theme_select_element = document.getElementById("theme");
                for (theme_path in theme_dict) {
                    const option_element = `<option value="${theme_path}">${theme_dict[theme_path]}</option>`;
                    theme_select_element.insertAdjacentHTML("beforeend", option_element);
                }
            }

            async function set_to_current_setting() {
                const setting_name_list = ["theme", "user_name", "news_site_url", "search_engine", "python_interpreter"];
                for (let i = 0; i < setting_name_list.length; i++) {
                    const setting_name = setting_name_list[i];
                    document.getElementById(setting_name) = await eel.read_setting(setting_name)();
                }
            }

            function save_setting() {
                eel.write_setting("setup_finished", "True");

                eel.change_theme(document.getElementById("theme").value);
                eel.write_setting("user_name", document.getElementById("user_name").value);
                eel.write_setting("news_site_url", document.getElementById("news_site_url").value);
                eel.write_setting("search_engine", document.getElementById("search_engine").value);
                eel.write_setting("python_interpreter", document.getElementById("python_interpreter").value);

                location.href = "index.html";
            }

            generate_theme_menu();

            set_to_current_setting();
        </script>
    </body>
</html>
